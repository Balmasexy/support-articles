<h1 id="01H8DBJ58BZ8HFDWWPS0GQGQ6F">How to build your own Custom AMI</h1>
<p>On hosted installations of CircleCI, the AMI used for VM Service, which provides access to a dedicated Docker daemon via the <code>machine</code> executor (see <strong><a href="https://circleci.com/docs/2.0/executor-types/#using-machine">Executor Types: Using Machine</a></strong>) and <code>setup_remote_docker</code> (see <strong><a href="https://circleci.com/docs/2.0/building-docker-images/#overview">Running Docker Commands: Overview</a></strong>), is completely customizable.</p>
<p>By extending our default installed set of packages and dependencies to create your own custom VM Service AMI, you can install custom versions of Docker, as well as pre-bake any common frameworks, security tools, proxy settings, etc., into the AMI itself, simplifying the required setup and configuration steps that might otherwise have to live in the config.yml configuration files for any projects with jobs that require the <code>machine</code> executor or <code>setup_remote_docker</code>.</p>
<p> </p>
<h1 id="01H8DBJ58BKZNN9GK3XCSVZ5NX">CircleCI Server 3.x/4.x</h1>
<p>To build the image, you can utilize our open-source <a href="https://github.com/CircleCI-Public/circleci-server-linux-image-builder" target="_blank" rel="noopener noreferrer">circleci-server-linux-image-builder</a>. </p>
<ul>
    <li>For AWS Installations, please view <a href="https://github.com/CircleCI-Public/circleci-server-linux-image-builder#for-aws" target="_blank" rel="noopener noreferrer">this link</a>.</li>
    <li>For GCP Installations, please view <a href="https://github.com/CircleCI-Public/circleci-server-linux-image-builder#for-gcp" target="_blank" rel="noopener noreferrer">this link</a>.</li>
</ul>
<h3 id="01H8DBJ58B2YHRJNCKBAV6XD0E">Server 4.x</h3>
<p>Once the image is built, you can customize the Server 4.x's <strong>Helm</strong> <code>values.yml</code> to include the image build like so: </p>
<pre style="background-color: #f3f3f3; padding: 5px;" data-darkreader-inline-bgcolor="">vm_service:<br>  providers:<br>    # for AWS<br>    ec2:<br>      ...<br>      linuxAMI: "&lt;my-linux-ami&gt;"<br>    <br>    # for GCP<br>    gcp:<br>      ...<br>      linuxImage: "&lt;my-linux-image&gt;"   </pre>
<p> </p>
<h3 id="01H8DBJ58B64ACPK6AGAPB9RHX">Server 3.x</h3>
<p>Once the image is built, you can add the AMI ID via the KOTS Admin Console. </p>
<p><img src="https://support.circleci.com/hc/article_attachments/11598366359195" alt="Screenshot_2022-12-27_at_4.17.19_PM.png"></p>
<h2 id="01H8DBJ58B8MMXHSCXTGY4J1FE"> </h2>
<h2 id="01H8DBJ58BAN0G7PFMWMQYQSTG">Additional Resources</h2>
<ul>
    <li><a href="https://support.circleci.com/hc/en-us/articles/360011133433" target="_blank" rel="noopener noreferrer">[Server] Clearing the Nomad job queue</a></li>
    <li><a href="https://support.circleci.com/hc/en-us/articles/360007993113" target="_blank" rel="noopener noreferrer">[Server] How to restart the Replicated services</a></li>
    <li><a href="https://circleci.com/docs/server-3-operator-troubleshooting-and-support/#start-kots-admin-console%C2%A0" target="_blank" rel="noopener noreferrer">How to start the KOTS Admin Console </a></li>
    <li><a href="https://circleci.com/docs/server-3-operator-troubleshooting-and-support/#managing-pods%C2%A0" target="_self" rel="undefined">How to manage pods</a></li>
</ul>
<p> </p>