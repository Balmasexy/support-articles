<h1>Overview</h1>
<p>When trying to use an arm-based Docker image with the Docker executor, you will see the following error:</p>
<pre style="background-color: #f3f3f3;" data-darkreader-inline-bgcolor=""><code>WARNING: docker image targets wrong architecture (found arm64 but need [amd64 i386 386])
</code></pre>
<p>Currently CircleCI does not support arm-based Docker images with the Docker executor, and the solution for this is to run the images on the Machine executor using an arm-based image.</p>
<h2>Solution</h2>
<p>Arm-based Docker images can be executed on the Machine executor by utilizing the command <code>docker run</code> and passing in the architecture for the <code>--platform</code> option.</p>
<p>Here is a sample config.yml file showing this implementation using the docker image <code>ruby:3.2.2-slim</code> with the Machine executor image <code>ubuntu-2004:2022.04.1</code> and logging out the architecture:</p>
<pre style="background-color: #f3f3f3;" data-darkreader-inline-bgcolor=""><code>version: 2.1

jobs:
  test:
    machine:
      image: ubuntu-2004:2022.04.1
    resource_class: arm.medium
    steps:
      - checkout
      - run: 
          name: Start arm docker container
          command: |
            docker run -idt --platform linux/arm64/v8 --name ruby ruby:3.2.2-slim
            docker exec -it ruby bash -c "uname -m"

workflows:
  arm-workflow:
    jobs:
      - test
</code></pre>
<h2>Additional Notes</h2>
<p>Please note that since you are starting the Docker container manually, you will need to structure your scripts such that they execute within the Docker container itself, and not directly inside of the environment created by the Machine executor image.</p>
<h2>Additional Resources:Â </h2>
<p>Please see the following resources for additional information on the Machine executor, and how to work with multi-platform Docker images.</p>
<ul>
    <li><a href="https://circleci.com/docs/using-linuxvm/" target="_blank" rel="noopener">Using the Linux VM execution environment</a></li>
    <li><a href="https://circleci.com/docs/using-arm/">Using the Arm execution environment</a></li>
    <li><a href="https://docs.docker.com/build/building/multi-platform/" target="_blank" rel="noopener">docker docs: Multi-platform images</a></li>
</ul>